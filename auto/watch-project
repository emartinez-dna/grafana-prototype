projectName=$1

source "${CONTAINER_WORKSPACE_FOLDER}/auto/_utils.sh"
sourcePath="`get-projectpath $projectName`/src"
sourcePathExitCode=$?
if [ "$sourcePathExitCode" -gt 0 ]
then
    echo "Unable to determine path to source: $sourcePath"
else
    if [ -d "$sourcePath" ]
    then
        echo "Watching $projectName. CTRL+C to exit."
        echo ""
        echo ""

        while true
        do
            startTime=`date +%s`
            echo "=== `date '+%F %H:%M:%S'` CHANGE DETECTED ==="
            build-project $projectName
            release-project $projectName
            endTime=`date +%s`
            echo "=== `date '+%F %H:%M:%S'` DONE ($(($endTime - $startTime)) seconds) ==="
            echo ""
            echo ""

            # this is the part that watches for changes.  It will sit here until a change is detected, 
            # then it will exit that program and go through the loop one more time.
            inotifywait -re create,modify,delete "$sourcePath" --quiet --quiet
        done
    else
        echo "In order to watch a project, it needs to contain a src folder.  Please create "$sourcePath". "
    fi
fi